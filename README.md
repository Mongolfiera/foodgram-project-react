![example workflow](https://github.com/mongolfiera/yamdb_final/actions/workflows/foodgram_workflow.yml/badge.svg)

# Foodgram «Продуктовый помощник»
*На этом сервисе пользователи смогут публиковать рецепты, подписываться на публикации других пользователей, добавлять понравившиеся рецепты в список «Избранное», а перед походом в магазин скачивать сводный список продуктов, необходимых для приготовления одного или нескольких выбранных блюд.*

[Foodgram - продуктовый помощник](http://158.160.72.168/)

Документация к API доступна по [ссылке](http://158.160.72.168/api/docs/)


## Мотивация

Сервис был написан как Дипломный Проект Курса «Python-разработчик» в [Яндекс Практикум](https://practicum.yandex.ru/).


## Технологии/Фреймворки

![Python version](https://img.shields.io/badge/Python-3.7-3670A0?style=plastic&logo=python&logoColor=ffdd54)
![Django version](https://img.shields.io/badge/Django-3.2-%23092E20.svg?style=plastic&logo=django&logoColor=white)
![DjangoREST version](https://img.shields.io/badge/DjangoREST-3.12-ff1709?style=plastic&logo=django&logoColor=white&color=ff1709&labelColor=gray)
![Requests version](https://img.shields.io/badge/Requests-2.26-006ADA?style=plastic&logo=PyPI&logoColor=ffdd54)
![Djoser version](https://img.shields.io/badge/Djoser-2.1-3670A0?style=plastic&logo=PyPI&logoColor=ffdd54)
![Postgres](https://img.shields.io/badge/postgres-%23316192.svg?style=plastic&logo=postgresql&logoColor=white)
![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=plastic&logo=docker&logoColor=white)
![Gunicorn](https://img.shields.io/badge/gunicorn-%298729.svg?style=plastic&logo=gunicorn&logoColor=white)
![Nginx](https://img.shields.io/badge/nginx-%23009639.svg?style=plastic&logo=nginx&logoColor=white)


## Сервисы и страницы проекта

### Главная страница
Содержимое главной страницы — список первых шести рецептов, отсортированных по дате публикации (от новых к старым).  Остальные рецепты доступны на следующих страницах: внизу страницы есть пагинация.
### Страница рецепта
На странице — полное описание рецепта. Для авторизованных пользователей — возможность добавить рецепт в избранное и в список покупок, возможность подписаться на автора рецепта.
### Страница пользователя
На странице — имя пользователя, все рецепты, опубликованные пользователем и возможность подписаться на пользователя.
### Подписка на авторов
Подписка на публикации доступна только авторизованному пользователю. Страница подписок доступна только владельцу.
Сценарий поведения пользователя:
Пользователь переходит на страницу другого пользователя или на страницу рецепта и подписывается на публикации автора кликом по кнопке «Подписаться на автора».
Пользователь переходит на страницу «Мои подписки» и просматривает список рецептов, опубликованных теми авторами, на которых он подписался. Сортировка записей — по дате публикации (от новых к старым).
При необходимости пользователь может отказаться от подписки на автора: переходит на страницу автора или на страницу его рецепта и нажимает «Отписаться от автора».
### Список избранного
Работа со списком избранного доступна только авторизованному пользователю. Список избранного может просматривать только его владелец.
Сценарий поведения пользователя:
Пользователь отмечает один или несколько рецептов кликом по кнопке «Добавить в избранное».
Пользователь переходит на страницу «Список избранного» и просматривает персональный список избранных рецептов.
При необходимости пользователь может удалить рецепт из избранного.
### Список покупок
Работа со списком покупок доступна авторизованным пользователям. Список покупок может просматривать только его владелец.
Сценарий поведения пользователя:
Пользователь отмечает один или несколько рецептов кликом по кнопке «Добавить в покупки».
Пользователь переходит на страницу Список покупок, там доступны все добавленные в список рецепты. Пользователь нажимает кнопку Скачать список и получает файл с суммированным перечнем и количеством необходимых ингредиентов для всех рецептов, сохранённых в «Списке покупок».
При необходимости пользователь может удалить рецепт из списка покупок.
Список покупок скачивается в формате .txt.
### Фильтрация по тегам
При нажатии на название тега выводится список рецептов, отмеченных этим тегом. Фильтрация может проводится по нескольким тегам в комбинации «или», если выбраны несколько тегов.
### Регистрация и авторизация
Обязательные поля для пользователя:
- Логин
- Пароль
- Email
- Имя
- Фамилия
#### Уровни доступа пользователей:
- Гость (неавторизованный пользователь)
- Авторизованный пользователь
- Администратор

##### Что могут делать неавторизованные пользователи
- Создать аккаунт.
- Просматривать рецепты на главной.
- Просматривать отдельные страницы рецептов.
- Просматривать страницы пользователей.
- Фильтровать рецепты по тегам.
##### Что могут делать авторизованные пользователи
- Входить в систему под своим логином и паролем.
- Выходить из системы (разлогиниваться).
- Менять свой пароль.
- Создавать/редактировать/удалять собственные рецепты
- Просматривать рецепты на главной.
- Просматривать страницы пользователей.
- Просматривать отдельные страницы рецептов.
- Фильтровать рецепты по тегам.
- Работать с персональным списком избранного: добавлять в него рецепты или удалять их, просматривать свою страницу избранных рецептов.
- Работать с персональным списком покупок: добавлять/удалять любые рецепты, выгружать файл с количеством необходимых ингредиентов для рецептов из списка покупок.
- Подписываться на публикации авторов рецептов и отменять подписку, просматривать свою страницу подписок.
##### Что может делать администратор
- Администратор обладает всеми правами авторизованного пользователя. 
- Изменять пароль любого пользователя,
- Создавать/блокировать/удалять аккаунты пользователей,
- Редактировать/удалять любые рецепты,
- Добавлять/удалять/редактировать ингредиенты.
- Добавлять/удалять/редактировать теги.

## Как запустить проект:

### Workflow
* tests - проверка кода на соответствие стандарту PEP8 (с помощью пакета flake8) и запуск pytest
* build_and_push_to_docker_hub - сборка и доставка докер-образа для контейнера web на Docker Hub
* deploy - автоматический деплой проекта на боевой сервер
* send_message - отправка уведомления в Telegram о том, что процесс деплоя успешно завершился


Клонируйте репозиторий и перейдите в него:
```bash
git clone git@github.com:Mongolfiera/foodgram-project-react.git
```

Добавьте в Settings -> Secrets -> Actions secrets переменные окружения:
```
DOCKER_USERNAME - имя пользователя в DockerHub в нижнем регистре
DOCKER_PASSWORD - пароль пользователя в DockerHub
SECRET_KEY - секретный ключ Django проекта
HOST - ip-адрес сервера
USER - имя пользователя для подключения к серверу
SSH_KEY - приватный ключ с компьютера, имеющего доступ к серверу
PASSPHRASE - фраза-пароль для ssh-ключа
TELEGRAM_TO - ID телеграм-аккаунта (узнать свой ID можно у бота @userinfobot)
TELEGRAM_TOKEN - токен бота (получить токен можно у бота @BotFather)
DB_NAME - postgres
DB_ENGINE - django.db.backends.postgresql
DB_HOST - db
DB_PORT - 5432
POSTGRES_USER - postgres
POSTGRES_PASSWORD - postgres
```

### Подготовка сервера

Остановите службу nginx:
```bash
sudo systemctl stop nginx 
```
Устанавите обновления:
```bash
sudo apt update
sudo apt upgrade -y 
```

Установите docker:
```bash
sudo apt install docker.io 
```
Установите docker-compose (для всех пользователей):
```bash
sudo mkdir -p /usr/local/lib/docker/cli-plugins
sudo curl -SL https://github.com/docker/compose/releases/download/v2.17.2/docker-compose-linux-x86_64 -o /usr/local/lib/docker/cli-plugins/docker-compose
sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose
```
Проверьте корректность установки docker-compose (в ответе должна быть версия): 
```bash
docker compose version
```

Скопируйте вручную файлы docker-compose.yaml и default.conf на сервер:
```bash
cd infra
scp docker-compose.yaml default.conf <username>@<host>:/home/<username>/
```

### Запуск проекта

Выполнить миграции
```bash
docker compose exec backend python manage.py makemigrations users
docker compose exec backend python manage.py makemigrations recipes
docker compose exec backend python manage.py migrate
```

Создать суперпользователя
```bash
docker compose exec backend python manage.py createsuperuser 
```

Загрузить статику
```bash
docker compose exec backend python manage.py collectstatic --no-input 
```

Для заполнения базы ингредиентами можно использовать команду
```bash
docker compose exec backend python manage.py load_data
```

Для создания тегов ("Зактрак", "Обед", "Ужин") можно использовать команду
```bash
docker compose exec backend python manage.py load_tags
```

Остановить работу всех контейнеров
```bash
docker compose down -v
```


## Лицензия

![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)
